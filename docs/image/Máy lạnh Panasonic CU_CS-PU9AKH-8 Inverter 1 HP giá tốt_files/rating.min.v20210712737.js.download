function initViewRt(){var n,t,i;window.location.href.indexOf("danh-gia")!=-1?$(".total-cmtrt").attr("href","#scrollList"):(n=$(".total-cmtrt").data("total"),t=$(".total-cmtrt").data("site"),n>=3&&t!==9&&(i=location.pathname.replace(/\/+$/,"")+"/danh-gia",$(".total-cmtrt").attr("href",i)))}function getScript(){initUploadRating()}function isImageFile(n,t,i){return new Promise((r,u)=>{const f=new FileReader;f.onload=function(n){const e=n=>String.fromCharCode.apply(null,n),o=n.target.result,f=new Uint8Array(o),s=f.subarray(0,4).toString(),u=e(f.subarray(0,8));u.startsWith("PNG\r\n\x1a\n")?r(!0):u.includes("GIF87a")?r(!0):["ÿØÿ","JFIF","Exif","PJPEG"].some(n=>u.includes(n))?r(!0):u.startsWith("%PDF")&&t==!0?r(!0):["ÐÏà","PK\x03\x04"].some(n=>u.includes(n))&&i==!0?r(!0):(console.log(!1),r(!1))};f.onerror=function(n){u(n)};f.readAsArrayBuffer(n)})}function POSTAjax(n,t,i,r,u,f){$.ajax({"async":f,url:n,data:t,type:"POST",cache:!1,beforeSend:function(){i()},success:function(n){r(n)},error:function(){u()}})}function clearRatingBox(){var n,t;$(".upload__img-wrap").empty();$(".fRContent").val("");$(".fRName").val("");$(".fRPhone").val("");$(".send-rate").addClass("disabled");n="(0 ký tự)";$(".ckt").html(n);t="0 chữ ";$(".ct").html(t);uploadedFile=0;imgArraySubApp=[]}function ResizeIframeRating(n){var i,t,r;if(window!==window.parent&&window.location.host===window.parent.location.host&&(i=document.body,t=document.documentElement,n||(n=$(".wrap_rating").height()+resizedHeight),r=Math.max(i.scrollWidth,i.offsetWidth,t.clientWidth,t.scrollWidth,t.offsetWidth),window.parent.document.getElementById("id-rating").height=n,window.parent.document.getElementById("id-rating").width=r,typeof window.parent.window.onloadCallbackRating=="function"))window.parent.window.onloadCallbackRating(n,r)}function initRatingAjax(){$(".wrap_rating").length>0&&$(".rating-topzone").length>0?initRatingControlAfterAjax():$(".wrap_rating").length>0&&loadRating();ResizeIframeRating()}function ratingScrollLst(){$(".detail-rate").unbind().click(function(){if($(".wrap_rating").length>0){let n=$("header").height()??0,t=parseInt($(".wrap_rating").css("marginTop").replace("px",""))??0,i=$(".wrap_rating").offset().top-n*2+t;$([document.documentElement,document.body]).animate({scrollTop:i},1999)}})}function deleteTempImageRtSA(){$(this).parent().parent().remove();uploadedFile--;var n=$(".wrap_rating .upload__img-wrap .upload__img-box").length;n==0&&$(".wrap_rating .upload__img-wrap").addClass("hide")}function initUploadRating(){$(".wrap_rating .send-img").unbind().on("click",function(){if($(".wrap_rating .upload__img-box").length>2)return alert("Đã up load quá số ảnh quy định"),!1;var n=getParams();$("#hdFileRatingUploadv2").click()});$("body").unbind().on("click",".upload__img-close",function(){$(this).parent().parent().remove();uploadedFile--;var n=$(".wrap_rating .upload__img-wrap .upload__img-box").length;n==0&&$(".wrap_rating .upload__img-wrap").addClass("hide")});var n=$(".wrap_rating .upload__inputfile").closest(".upload__box").find(".upload__img-wrap");$("#hdFileRatingUpload").html5Uploader({postUrl:urlRoot+"/comment/commentnew/CommentExt/UpImg",onClientError:function(){},onClientProgress:function(){},onClientLoadStart:function(){},onServerAbort:function(){},onServerError:function(){},onServerLoadStart:function(){n.append("<div class='upload__img-box loading-amt'><svg viewBox = '0 0 36 36' class='circular-chart'> <path class='circle-bg' d='M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831'><\/path><path class='circle' stroke-dasharray='100, 100' d='M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831'><\/path><\/svg ><div class='img-bg'><div class='upload__img-close'><\/div><\/div><\/div> ");$(".wrap_rating .upload__img-wrap").removeClass("hide")},onServerProgress:function(){},onClientLoad:function(){},onServerReadyStateChange:function(n,t,i){i==4&&n.currentTarget.status==404&&($(".upload__img-box.loading-amt").first().remove(),alert("Dung lượng ảnh tối đa 4 MB."))},onClientLoadEnd:function(){},onServerLoad:function(){},onSuccess:function(n){var t=$.parseJSON(n.currentTarget.response),i;t.status==-1?(alert("Xảy ra lỗi, vui lòng thử lại."),$(".upload__img-box.loading-amt").first().remove()):(i="<div class='upload__img-box'><div style='background-image: url("+t.imageUrl+")' data-number='"+$(".upload__img-close").length+"' data-file='"+t.imageName+"' class='img-bg'><div class='upload__img-close'><\/div><\/div><\/div>",$(".upload__img-box.loading-amt").first().replaceWith(i),uploadedFile++,console.log("uploadedFile: "+uploadedFile),console.log("onSuccess - upload RatingIMG"))}})}function loadRating(){const n=getParams();$.ajax({type:"POST",url:urlRoot+"/comment/init",data:{objectId:n.objectId,title:n.title,url:n.url,ismb:n.ismb,urlimg:n.urlimg,objectType:n.objectType,siteId:n.siteId,showRating:n.isRating},success:function(t){$(".wrap_rating").html(t);(n.siteId==10||n.siteId==16||n.siteId==17||n.siteId==1||n.siteId==2)&&$(".wrap_rating").addClass("wrap_border");($("div.box-rating").length||$("div.rating-topzone").length)&&initRatingControlAfterAjax()},error:function(n,t,i){console.log(n);console.log(t);console.log(i)},complete:function(){}})}function checkLikedCookie(){var n=getCookieRtSubApp("mwg_like"),t;n!=null&&(t=n.split(","),$.each(t,function(n,t){$("#r-"+t+" .cmtl").attr("href","javascript:;");$("#l-"+t).removeClass("iconcmt-thumpup").addClass("iconcmt-likeR");likedList.push(t)}))}function getCookieRtSubApp(n){var i,t;try{var r=n+"=",f=decodeURIComponent(document.cookie),u=f.split(";");for(i=0;i<u.length;i++){for(t=u[i];t.charAt(0)==" ";)t=t.substring(1);if(t.indexOf(r)==0)return t.substring(r.length,t.length)}return""}catch(e){return""}}function closePopupRt(){$(".fRPhone").val()==""?($(".popup-rating-topzone").fadeOut(),$(".bg-coverrate").fadeOut()):$(".fRName").val()!=""||$(".fRContent").val()!=""?($(".bgcover-errorForm").fadeIn(),$(".popup-incomplete").fadeIn()):($(".popup-rating-topzone").fadeOut(),$(".bg-coverrate").fadeOut());ResizeIframeRating();CloseMainPopupRatingIframe()}function initRatingControlAfterAjax(){ratingScrollLst();checkLikedCookie();initRatingSubApp();checkPopupRating();initImgGallery();getHref();initViewRt();IsStaging&&($(".staging").removeClass("staging"),$(".form-column-staging").removeClass("form-column-staging"));initUploadV2API()}function timeBetween(n,t){var i=new Date;return i>=n&&i<=t}function sendRatingV2(n){var u,i,r;getImgRating();n&&$(".popup-incomplete").fadeOut();var f=$(".popup-rating-topzone .form-rate"),t=f.serializeArray(),e=$(".wrap_rating").data("siteid"),o=$(".active-slt").data("val"),s=$(".form-rate .agree span").hasClass("current");if(t.push({name:"siteId",value:e}),t.push({name:"hdfStar",value:o}),t.push({name:"isShared",value:s}),u=urlRoot+"/comment/SubmitRatingCommentV2",window!==window.parent?ReassignData(t,"hdUrl",encodeURIComponent(window.parent.location.href)):ReassignData(t,"hdUrl",encodeURIComponent(window.location.href)),$(".fRContent").val()==""&&!n){$(".popup-errorForm").not(".popup-incomplete").fadeIn();$(".bgcover-errorForm").fadeIn();return}if(i=new FormData,imgArraySubApp.length>0)for(r=0;r<imgArraySubApp.length;r++)i.append("files",imgArraySubApp[r].file);$(t).each(function(n,t){i.append(t.name,t.value)});console.log(i);xhrSendRt&&xhrSendRt.abort();xhrSendRt=$.ajax({"async":!0,url:u,data:i,type:"POST",processData:!1,cache:!1,contentType:!1,success:function(n){var t;if(typeof n=="object"?t=n:typeof n=="string"&&(t=JSON.parse(n)),n!=null||n!="")try{t.res===1?($(".popup-rating-topzone").fadeOut(),getParams().siteId==9?$(".popup-success.tet").length>0?$(".popup-success.tet").fadeIn():$(".popup-success").not(".tet").fadeIn():$(".popup-success").not(".tet").fadeIn(),clearRatingBox()):t.res===0&&alert(t.mes);initRatingSubApp()}catch(i){gl_sendRating=!1}},error:function(){$(".popup-rating-topzone").fadeOut();$(".wrap_rating .bg-coverrate").fadeOut();clearRatingBox();alert("Có lỗi xảy ra, vui lòng thử lại")}})}function initUploadV2API(){$("#hdFileRatingUploadv2").each(function(){$(this).on("change",function(n){var t=$(".upload__img-box").length,i=n.target.files,r=Array.prototype.slice.call(i);r.forEach(function(n,i){var f,u,r;if(i+1+t>3){alert("Chỉ được upload tối đa 3 hình");return}if(!n.type.match("image.*")){isCallAjax=!1;return}if(n.size/1048576>5){isCallAjax=!1;alert("hình ảnh "+n.name+" không được quá 5mb");return}if(t>3)return $("#productimage").val(""),alert("Chỉ được upload tối đa 3 hình"),!1;if(f={file:n,path:"",isUpload:!1},u=!1,imgArraySubApp.length>0)for(r=0;r<imgArraySubApp.length;r++)imgArraySubApp[r].file!==undefined&&imgArraySubApp[r].file.name===n.name&&(u=!0);u||imgArraySubApp.push(f);const e=isImageFile(n,!1,!1);e.then(t=>{if(t){var i=new FileReader;i.onload=function(){var r,t,u,f;$(".upload__img-wrap").removeClass("hide");r=document.createElement("div");r.classList.add("upload__img-close");r.setAttribute("onclick","deleteTempImageRtSA(this)");r.setAttribute("data-file",n.name);t=document.createElement("div");t.appendChild(r);t.classList.add("img-bg");t.setAttribute("style",`background-image:url('${i.result}')`);u=document.createElement("div");u.classList.add("upload__img-box");f=document.createElement("div");t.appendChild(f);u.appendChild(t);$(".upload__img-wrap").append(u)};i.readAsDataURL(n)}else return alert("Không thể chọn file có định dạng khác PNG, JPEG! Tệp không hợp lệ: "+n.name),!1}).catch(n=>{console.error("Lỗi:",n)})})})})}function countTxtRating(){$(".ct").hide();$(".fRContent").keyup(function(){if($(".fRContent").val().length>0){$(".ct").show();var n=$(".fRContent").val().replace(/^[\s,.;!?/()]+/,"").replace(/[\s,.;!?/()]+$/,"").split(/[\s,.;!?/()]+/).length,t=n+" chữ";$(".ct").html(t)}else $(".ct").hide()})}function ShowMainPopupRatingIframe(){var n,t;window!==window.parent&&(n=window.parent.window.innerHeight*3/4,$(".popup-rating-topzone").height(n),t=$(".popup-rating-topzone")[0].scrollHeight,ResizeIframeRating(t+100),StylePopupIframe())}function CloseMainPopupRatingIframe(){isIframe&&window.parent.document.getElementById("id-container-rating").removeAttribute("style")}function StylePopupIframe(){if(window!==window.parent){var n=window.parent.document.getElementById("id-container-rating");n.style.cssText="background-color: rgba(0, 0, 0);position: fixed;bottom: 0px;top: 0px;left: 0px;width: 100%;z-index: 22;"}}function toggleSubmitBtn(){let n=$("#agree-policy-rating span"),t=n.length>0&&n.hasClass("current")||n.length==0;t&&$(".fRPhone").val()!=""&&$(".fRName").val()!=""?$(".send-rate").removeClass("disabled"):$(".send-rate").addClass("disabled")}function initPersonelDataPolicy(){let n=$("#agree-policy-rating span");$("#agree-policy-rating").unbind().click(function(){n.toggleClass("current");toggleSubmitBtn()});$("#agree-policy-rating a").click(function(n){n.stopPropagation()});toggleSubmitBtn()}function initRatingSubApp(){initPersonelDataPolicy();$(".wrap_rating .send-img").unbind().click(function(){getScript();var n=!1;n||($("#hdFileRatingUploadv2").click(),n=!0)});$(".fRName").keyup(function(){toggleSubmitBtn()});$(".fRPhone").keyup(function(){toggleSubmitBtn()});$(".ctnsend-continue").click(function(){$(".popup-errorForm").fadeOut();$(".bgcover-errorForm").fadeOut();$(".fRContent").focus()});$(".btn-write").unbind().click(function(){$(".rating-topzonecr-star li i").removeClass("active");$(".rating-topzonecr-star li p").removeClass("active-slt");$(".form-rate").hide();$(".popup-rating-topzone").fadeIn();$(".bg-coverrate").fadeIn();ShowMainPopupRatingIframe()});$(".form-rate .form-column .agree").unbind().click(function(){$(".form-rate .form-column .agree span").toggleClass("current")});$(".click-openpopup").unbind().click(function(){$(".popup-rating-topzone").fadeIn();$(".bg-coverrate").fadeIn();ShowMainPopupRatingIframe()});$(".close-rate").unbind().click(function(){closePopupRt()});$(".rating-topzonecr-star li").click(function(){$(".form-rate").show();$(".rating-topzonecr-star li i").removeClass("active");$(".rating-topzonecr-star li p").removeClass("active-slt");var n=parseInt($(this).attr("data-val"));$(".rating-topzonecr-star li").each(function(t,i){$(i).data("val")>n?$(i).find("i").removeClass("active"):$(i).data("val")==n?($(i).find("p").addClass("active-slt"),$(i).find("i").addClass("active")):($(i).find("i").addClass("active"),$(i).find("p").removeClass("active-slt"))});$(".rating-topzonecr-star li p").eq(n-1).addClass("active-slt")});$(".popupratingfuntion").click(function(){$(".popupratingzone").show();$(".customerrating").fadeIn();$(".bg-popuprating").show();$("body").addClass("hiden")});$(".close-popupratingzone").click(function(){$(".popupratingzone").hide();$(".bg-popuprating").hide();$("body").removeClass("hiden")});$(".bg-popuprating").click(function(){$(".popupratingzone").hide();$(".bg-popuprating").hide()});$(".closethanks-rt, .close-popup").click(function(){$(".ratingthanks").hide()});$(".frtip .ipt label").click(function(){var n=$(this).data("gender");$(".gendercomment label").removeClass("choose");$(this).addClass("choose");$("input[name=hdGender]").val(n)});$(".input .if [name=fRPhone]").unbind();$(".input .if [name=fRPhone]").keydown(function(n){$.inArray(n.keyCode,[46,8,9,27,13,110,190])!==-1||n.keyCode===65&&(n.ctrlKey===!0||n.metaKey===!0)||n.keyCode>=35&&n.keyCode<=40||(n.shiftKey||n.keyCode<48||n.keyCode>57)&&(n.keyCode<96||n.keyCode>105)&&n.preventDefault()});$(".ctnsend-rate").not(".ctnsend-continue").click(function(){$(".popup-errorForm").fadeOut();$(".bgcover-errorForm").fadeOut();$(".popup-rating-topzone").fadeOut();$(".bg-coverrate").fadeOut()});$(".unsend-rate").unbind().click(function(n){n.preventDefault();$(".popup-incomplete").fadeOut();console.log("...");$(".wrap_rating .send-rate")[1].click()});$("#submitrt").unbind().click(function(n){n.preventDefault();sendRatingV2(!0)});$(".comment-list .par").each(function(){var n=$(this).attr("id"),t;n=n.replace("r-","");t=$(".comment-list .rp-"+n).length;t>0&&$(this).find(".count-tl").text("("+t+")")});countTxtRating()}function ReassignData(n,t,i){var r=n.find(n=>n.name===t);r.value=i}function popupSuccessShow(){$(".popup-success").fadeIn();$(".bgcover-success").fadeIn()}function validateOnlyNumber(n){var t=n.which,i=n.target.value;((t<48||t>57)&&t!==43||i.length>=10)&&n.preventDefault()}function popupSuccessHide(){$(".popup-success").fadeOut();$(".bgcover-success").fadeOut();$(".bg-coverrate").fadeOut();$("body").removeClass("scrollHide");CloseMainPopupRatingIframe();ResizeIframeRating()}function popupNotiShow(){$(".popup-errorForm").not(".popup-incomplete").fadeIn();$(".bgcover-errorForm").fadeIn()}function popupNotiHide(){$(".popup-errorForm").not(".popup-incomplete").fadeOut();$(".bgcover-errorForm").fadeOut();CloseMainPopupRatingIframe();ResizeIframeRating()}function deleteTempImageRtSA(n){var i,t,r;for(uploadedFile--,i=$(n).data("file"),console.log("filename remove: ",i),t=0;t<imgArraySubApp.length;t++)imgArraySubApp[t].file.name==i&&(imgArraySubApp.splice(t,1),$(n).parent().parent().remove(),uploadedFile--);r=$(".wrap_rating .upload__img-wrap .upload__img-box").length;r==0&&$(".wrap_rating .upload__img-wrap").addClass("hide")}function sendRating(n){var i;getImgRating();n&&$(".popup-incomplete").fadeOut();var r=$(".popup-rating-topzone .form-rate"),t=r.serializeArray(),u=$(".wrap_rating").data("siteid"),f=$(".active-slt").data("val"),e=$(".form-rate .agree span").hasClass("current");if(t.push({name:"siteId",value:u}),t.push({name:"isStaging",value:IsStaging}),t.push({name:"hdfStar",value:f}),t.push({name:"isShared",value:e}),i=urlRoot+"/comment/SubmitRatingComment/",window!==window.parent?ReassignData(t,"hdUrl",encodeURIComponent(window.parent.location.href)):ReassignData(t,"hdUrl",encodeURIComponent(window.location.href)),$(".fRContent").val()==""&&!n){$(".popup-errorForm").not(".popup-incomplete").fadeIn();$(".bgcover-errorForm").fadeIn();return}xhrSendRt&&xhrSendRt.abort();xhrSendRt=$.ajax({"async":!0,url:i,data:t,type:"POST",cache:!1,success:function(n){if(n!=null||n!="")try{n.res==1?($(".popup-rating-topzone").fadeOut(),getParams().siteId==9&&IsStaging?$(".popup-success.tet").length>0?$(".popup-success.tet").fadeIn():$(".popup-success").not(".tet").fadeIn():$(".popup-success").not(".tet").fadeIn(),moveFile(n.rtid),clearRatingBox()):n.res==0&&alert(n.mes);initRatingSubApp()}catch(t){gl_sendRating=!1}},error:function(){}})}function moveFile(n){var r=urlRoot+"/comment/commentnew/CommentExt/MoveFileUpImg",i="",t;$(".img-bg").length>0&&($(".img-bg").each(function(){var n=$(this).data("file");n!=null&&n!=""&&(i+=n+"╬")}),t=new FormData,t.append("attachFile",i),t.append("commentID",n),$.ajax({url:r,type:"POST",processData:!1,contentType:!1,data:t,success:function(){},error:function(n,t,i){console.log(n.status);console.log(i)}}))}function showRatingCmtChild(n){var t=n.replace("r-",""),i;$(".rp-"+t).removeClass("hide");$(".rr-"+t).removeClass("hide");i=getCookie("tgdd_fullname");(i==null||i=="")&&$(".rr-"+t+" .ifrl").removeClass("hide").addClass("hide")}function likeRating(n){const t=getParams();var i={id:n,objectType:t.objectType,objectId:t.objectId,pageIndex:parseInt($(".wrap_rating .pagcomment").find("span.active").text())-1,pageSize:3,siteId:t.siteId,isBuy:1},r=urlRoot+"/comment/LikeRating/";POSTAjax(r,i,function(){},function(t){var i,r;if(t!=null||t!="")try{i=parseInt($("#r-"+n+" .cmtl").attr("data-like"));i++;$("#r-"+n).attr("data-like",i);r="<i class='iconcmt-likeR'><\/i>Hữu ích ("+i+")";$("#r-"+n+" .cmtl").html(r);$("#r-"+n+" .cmtl").attr("href","javascript:;");likedList.push(n);CreateCookie("mwg_like",likedList)}catch(u){}},function(){},!0)}function clearBorder(){$(".boxRatingCmt .ct").removeClass("borderWn");$(".boxRatingCmt .if input").removeClass("borderWn")}function checkPopupRating(){setTimeout(function(){var t=getUrlParameter("popuprating"),n,i,r;t!=null&&t!=""?(console.log("popuprating: "+t),n=t.split("-"),n.length>2&&n[0]==1&&($(".frtip").remove(),$(".fsrt").remove(),$(".wrap_fdback").removeClass("hide"),$(".wrap_fdback form.input").show(),i=n[1],r=n[2],i!=null&&i!=""&&($(".wrap_fdback .input [name='fRName']").val(i),$(".wrap_fdback .input [name='fRPhone']").val(r)))):$(".wrap_fdback").remove()},1e3)}function ratingCmtList(n){const t=getParams();var i={siteId:t.siteId,productid:t.objectId,page:n},r=urlRoot+"/comment/PagingRating";$.ajax({url:r,type:"POST",data:i,cache:!1,beforeSend:function(){$("#dlding").show()},success:function(n){if(n!=null||n!="")try{$(".rt-list").html(n);$(".comment-list .par").each(function(){var n=$(this).attr("id"),t;n=n.replace("r-","");t=$(".comment-list .rp-"+n).length;t>0&&$(this).find(".count-tl").text("("+t+")")});checkLikedCookie();$(".comment-list li .confirm-buy").unbind();$(".comment-list li .confirm-buy").click(function(){var n=$(this).parents("li").attr("id");$("#"+n).find(".popup-cfbuy").is(":visible")?$("#"+n).find(".popup-cfbuy").hide():$("#"+n).find(".popup-cfbuy").show()});$(".close-rcf").click(function(){var n=$(this).parents("li").attr("id");$("#"+n).find(".popup-cfbuy").is(":visible")?$("#"+n).find(".popup-cfbuy").hide():$("#"+n).find(".popup-cfbuy").show()});$(".btn-write").click(function(){$(".rating-topzonecr-star li i").removeClass("active");$(".rating-topzonecr-star li p").removeClass("active-slt");$(".form-rate").hide();$(".popup-rating-topzone").fadeIn();$(".bg-coverrate").fadeIn()})}catch(t){console.log(t);hideloading()}},error:function(){},complete:function(){ResizeIframeRating()}})}function ratingListRefer(){const n=getParams();var t=urlRoot+"/comment/RatingListRefer";$.ajax({url:t,type:"POST",data:{productid:n.objectId,siteId:n.siteId},cache:!1,beforeSend:function(){$("#dlding").show()},success:function(n){if(n!=null||n!="")try{$(".box-rating .comment-list").html(n);$(".comment-list .par").each(function(){var n=$(this).attr("id"),t;n=n.replace("r-","");t=$(".comment-list .rp-"+n).length;t>0&&$(this).find(".count-tl").text("("+t+")")});$(".comment-list li .confirm-buy").unbind();$(".comment-list li .confirm-buy").click(function(){var n=$(this).parents("li").attr("id");$("#"+n).find(".popup-cfbuy").is(":visible")?$("#"+n).find(".popup-cfbuy").hide():$("#"+n).find(".popup-cfbuy").show()});$(".close-rcf").click(function(){var n=$(this).parents("li").attr("id");$("#"+n).find(".popup-cfbuy").is(":visible")?$("#"+n).find(".popup-cfbuy").hide():$("#"+n).find(".popup-cfbuy").show()})}catch(t){console.log(t);hideloading()}},error:function(){}})}function ratingReferPagingList(n){const t=getParams();var i={siteid:t.siteId,productid:t.objectId,page:n},r=urlRoot+"/comment/PagingRatingRefer";$.ajax({url:r,type:"POST",data:i,cache:!1,beforeSend:function(){$("#dlding").show()},success:function(n){if(n!=null||n!="")try{$(".box-rating .comment-list").html(n);$(".comment-list .par").each(function(){var n=$(this).attr("id"),t;n=n.replace("r-","");t=$(".comment-list .rp-"+n).length;t>0&&$(this).find(".count-tl").text("("+t+")")});$(".comment-list li .confirm-buy").unbind();$(".comment-list li .confirm-buy").click(function(){var n=$(this).parents("li").attr("id");$("#"+n).find(".popup-cfbuy").is(":visible")?$("#"+n).find(".popup-cfbuy").hide():$("#"+n).find(".popup-cfbuy").show()});$(".close-rcf").click(function(){var n=$(this).parents("li").attr("id");$("#"+n).find(".popup-cfbuy").is(":visible")?$("#"+n).find(".popup-cfbuy").hide():$("#"+n).find(".popup-cfbuy").show()})}catch(t){console.log(t);hideloading()}},error:function(){}})}function getUrlParameter(n){for(var u=decodeURIComponent(window.location.search.substring(1)),r=u.split("&"),t,i=0;i<r.length;i++)if(t=r[i].split("="),t[0]===n)return t[1]===undefined?!0:t[1]}function getImgRating(){if($(".img-bg").length>0){var n="";$(".img-bg").each(function(){var t=$(this).data("file");t!=null&&t!=""&&(n+=t+"╬")});$(".hdfRatingImg").val(n)}else $(".hdfRatingImg").val("")}function CreateCookie(n,t,i){var r=new Date,u;r.setDate(r.getDate()+i);u=escape(t)+(i==null?"":"; visited=true; path=/; domain="+urlRoot+"; expires="+r.toUTCString()+";");document.cookie=n+"="+u}function CreateCookieWithHour(n,t,i){var r=new Date,u;r.setMinutes(r.getMinutes()+i);u=escape(t)+(i==null?"":"; visited=true; path=/; domain="+urlRoot+"; expires="+r.toUTCString()+";");document.cookie=n+"="+u}function Delete_Cookie(n,t,i){getCookie(n)&&(document.cookie=n+"="+(t?";path="+t:"")+(i?";domain="+i:"")+";expires=Thu, 01 Jan 1970 00:00:01 GMT")}function closePopupGallerySARating(){$(".popup-commentImg.rt").fadeOut(durationSA);$(".bg-commentImg.rt").fadeOut(durationSA);$("body").removeClass("scrollHide");CloseMainPopupRatingIframe()}function initImgGallery(){$(".commentImg-close.rt").click(function(){closePopupGallerySARating()});$(".bg-commentImg.rt").click(function(){closePopupGallerySARating()});$(".gallery__tab a").unbind().click(function(n){n.preventDefault();$(".gallery__tab a").removeClass("act");var t=$(this).attr("href");t=t.substr(1);$(this).addClass("act");$(".gallery__content li").each(function(){$(this).hasClass(t)||t=="all"?$(this).removeClass("hide"):$(this).addClass("hide")})});$(".gallery-close.rt").click(function(){$(".gallery.rt").fadeOut();$(".bg-galleryImg.rt").fadeOut();$("body").removeClass("scrollHide");CloseMainPopupRatingIframe()});$(".bg-galleryImg.rt").click(function(){$(".gallery.rt").fadeOut();$("body").removeClass("scrollHide");$(this).fadeOut()})}function showPopupGallerySARating(n){$(".bg-commentImg.rt").fadeIn(durationSA);$(".popup-commentImg.rt").fadeIn(durationSA);initRtSlide();$(".gallery.rt").fadeOut(durationSA);$(".bg-galleryImg.rt").fadeOut(durationSA);$("body").addClass("scrollHide");var t=parseInt(n);$(".slider-commentImg.rt").trigger("to.owl.carousel",t-1)}function PopupCommentImg(n){StylePopupIframe();typeof $.fn.owlCarousel=="function"?showPopupGallerySARating(n):$.getScript("https://cdn.tgdd.vn/mwgcart/avacomment/lib/OwlCarousel2/owl.carousel.min.js").done(function(){$("<link/>",{rel:"stylesheet",type:"text/css",href:"https://cdn.tgdd.vn/mwgcart/avacomment/lib/OwlCarousel2/assets/owl.carousel.min.css"}).appendTo("head");showPopupGallerySARating(n)})}function PopupGallleryImg(){$(".popup-commentImg.rt").fadeOut();$(".bg-commentImg.rt").fadeOut();$("body").addClass("scrollHide");$(".gallery.rt").fadeIn();$(".bg-galleryImg.rt").fadeIn();StylePopupIframe()}function getRatingGalleryContentById(n){let t=n.data("rid");typeof t=="undefined"||t<=0||n.hasClass("ajax-loaded")||$.ajax({url:"/comment/apicomment/getcommentbyid-min",type:"POST",data:{commentId:t},cache:!1,beforeSend:function(){},success:function(n){if(n.code==200&&n!=null&&n.data!=null){let r=n.data,i=$(`.item-content-${t}`);i.removeClass("hide-visibility");i.parents(".item").addClass("ajax-loaded");r.hasRecommendProduct==1&&i.find(".txt-intro").removeClass("hide");r.content!=""&&i.find(".item-ct").html(r.content);r.userProfile!=""&&i.find(".txt-name").html(r.userProfile);i.removeClass("hide-visibility")}},error:function(){}})}function getRatingOnSlider(){initSliderRating||(initSliderRating=$(".slider-commentImg.rt").on("changed.owl.carousel",function(n){if(n.item.index==0)getRatingGalleryContentById($($(".slider-commentImg.rt .item")[0]));else{let t=$($(".slider-commentImg.rt .owl-item .item")[n.item.index]);getRatingGalleryContentById(t)}}))}function initRtSlide(){let n=$(window).width();if(n>768)getRatingOnSlider(),$(".slider-commentImg.rt").owlCarousel({items:1,dots:!1,nav:!0,lazyLoad:!0,smartSpeed:100});else{getRatingOnSlider();$(".slider-commentImg.rt").on("initialized.owl.carousel changed.owl.carousel",function(n){n.namespace&&$(".counter-popup").text(n.relatedTarget.relative(n.item.index)+1+"/"+n.item.count)});$(".slider-commentImg.rt").owlCarousel({items:1,dots:!1,nav:!1,lazyLoad:!0,smartSpeed:100})}}function getHref(){let n=location.pathname.replace(/\/+$/,"")+"/danh-gia";$(".wrap_rating .btn-view-all").attr("href",n)}function goToRSlideByAttID(n){$(".rtAtt-"+n).click()}var gl_sendRating,initSliderRating;(function(n){n.fn.html5Uploader=function(t){function e(n){var e=new FileReader,t,s,o;e.onabort=function(t){if(i.onClientAbort)i.onClientAbort(t,n)};e.onerror=function(t){if(i.onClientError)i.onClientError(t,n)};e.onload=function(t){if(i.onClientLoad)i.onClientLoad(t,n)};e.onloadend=function(t){if(i.onClientLoadEnd)i.onClientLoadEnd(t,n)};e.onloadstart=function(t){if(i.onClientLoadStart)i.onClientLoadStart(t,n)};e.onprogress=function(t){if(i.onClientProgress)i.onClientProgress(t,n)};e.readAsDataURL(n);t=new XMLHttpRequest;t.upload.onabort=function(t){if(i.onServerAbort)i.onServerAbort(t,n)};t.upload.onerror=function(t){if(i.onServerError)i.onServerError(t,n)};t.upload.onload=function(t){if(i.onServerLoad)i.onServerLoad(t,n)};t.upload.onloadstart=function(t){if(i.onServerLoadStart)i.onServerLoadStart(t,n)};t.upload.onprogress=function(t){if(i.onServerProgress)i.onServerProgress(t,n)};t.onreadystatechange=function(r){if(i.onServerReadyStateChange)i.onServerReadyStateChange(r,n,t.readyState);if(i.onSuccess&&t.readyState==4&&t.status==200)i.onSuccess(r,n,t.responseText);if(i.onServerError&&t.readyState==2&&t.status==500)i.onServerError(r,n)};t.open("POST",i.postUrl,!0);n.getAsBinary?(s=f+u+r+'Content-Disposition: form-data;name="'+i.name+'";filename="'+unescape(encodeURIComponent(n.name))+'"'+r+"Content-Type: application/octet-stream"+r+r+n.getAsBinary()+r+f+u+f,t.setRequestHeader("Content-Type","multipart/form-data;boundary="+u),t.sendAsBinary(s)):window.FormData&&(o=new FormData,o.append(i.name,n),t.send(o))}var r="\r\n",u="iloveigloo",f="--",i={maxFile:3,maxSize:4,name:"uploadedFile",postUrl:"Upload.ashx",onClientAbort:null,onClientError:null,onClientLoad:null,onClientLoadEnd:null,onClientLoadStart:null,onClientProgress:null,onServerAbort:null,onServerError:null,onServerLoad:null,onServerLoadStart:null,onServerProgress:null,onServerReadyStateChange:null,onSuccess:null};return t&&n.extend(i,t),this.each(function(){var t=n(this);t.is('[type="file"]')?t.bind("change",function(){var n=this.files,t;if(typeof uploadedFile!="undefined"&&(uploaded=uploadedFile+n.length),typeof uploadedFileCommentSubApp!="undefined"?uploadedCmt=uploadedFileCommentSubApp+n.length:typeof uploadedFileMap!="undefined"&&rating_popup.data("index")>-1&&(uploaded=uploadedFileMap.get(`uploadedFile${rating_popup.data("index")}`)+n.length),typeof uploaded!="undefined"&&uploaded>i.maxFile)return alert("Chỉ cho phép tối đa "+i.maxFile+" file. Quý khách vui lòng gửi lại."),!1;if(typeof uploadedCmt!="undefined"&&uploadedCmt>i.maxFile)return alert("Chỉ cho phép tối đa "+i.maxFile+" file. Quý khách vui lòng gửi lại"),!1;for(t=0;t<n.length;t++){if(n[t].size>i.maxSize*1048576)return alert("Dung lượng tối đa cho phép là "+i.maxSize+"MB."),!1;e(n[t])}}):t.bind("dragenter dragover",function(){return!1}).bind("drop",function(n){var t=n.originalEvent.dataTransfer.files,r;if((typeof uploadedFile!="undefined"&&(uploaded=uploadedFile+t.length),typeof uploadedFileCommentSubApp!="undefined"?uploadedCmt=uploadedFileCommentSubApp+t.length:typeof uploadedFileMap!="undefined"&&rating_popup.data("index")>-1&&(uploaded=uploadedFileMap.get(`uploadedFile${rating_popup.data("index")}`)+t.length),typeof uploaded!="undefined"&&uploaded>i.maxFile)||typeof uploadedCmt!="undefined"&&uploadedCmt>i.maxFile)return alert("Chỉ cho phép tối đa "+i.maxFile+" file. Quý khách vui lòng gửi lại."),!1;for(r=0;r<t.length;r++){if(t[r].size>i.maxSize*1048576)return alert("Dung lượng tối đa cho phép là "+i.maxSize+"MB."),!1;e(t[r])}return!1})})}})(jQuery);var urlSub=window.location.origin,urlRoot=window.location.origin,uploadedFile=0,IsStaging=urlSub.indexOf("newstg")!=-1||urlSub.indexOf("newstaging")!=-1||urlSub.indexOf("staging")!=-1||urlSub.indexOf("localhost")!=-1,isIframe=window!==window.parent&&window.location.host===window.parent.location.host,isMobile=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent),resizedHeight=isMobile?40:110,durationSA=isIframe?0:400,xhrSendRt,imgArraySubApp=[],likedList=[];$(document).ready(function(){initRatingAjax();document.zNSRating&&setTimeout(function(){$(".locationbox__overlay").hide();$(".rating-topzonecr-star li i").removeClass("active");$(".rating-topzonecr-star li p").removeClass("active-slt");$(".form-rate").hide();$(".popup-rating-topzone").fadeIn();$(".bg-coverrate").fadeIn();var n=new URLSearchParams(window.location.search),t=n.get("name"),i=n.get("phone");$("input[name=fRName]").val(t);$("input[name=fRPhone]").val(i);initRatingSubApp()},500)});const getParams=()=>{const n=$(".wrap_rating").data("urlimg"),t=$(".wrap_rating").data("objectid"),i=$(".wrap_rating").data("url"),r=$(".wrap_rating").data("title"),u=$(".wrap_rating").data("objecttype"),f=$(".wrap_rating").data("irt"),e=$(".wrap_rating").data("siteid"),o=$(".wrap_rating").data("ismb");return{urlimg:n,objectId:t,url:i,title:r,objectType:u,isRating:f,siteId:e,ismb:o}};gl_sendRating=!1;