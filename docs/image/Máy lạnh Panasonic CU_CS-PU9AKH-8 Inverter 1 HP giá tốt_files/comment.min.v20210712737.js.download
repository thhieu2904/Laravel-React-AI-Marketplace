function initUploadCommentSubApp(){$("#commentUpload .send-img").unbind().on("click",function(){if(console.log("up Img comment"),$("#commentUpload .upload__img-box").length>2)return console.log("Vui lòng upload tối đa 3 ảnh"),!1;$("#hdFileCommentUploadv2").click()});$("body").unbind().on("click","#commentUpload .upload__img-close",function(){$(this).parent().parent().remove();uploadedFileCommentSubApp--;uploadedFileCommentSubApp==0&&$("#commentUpload .upload__img-wrap").addClass("hide")});var n=$("#commentUpload .upload__inputfile").closest(".upload__box").find(".upload__img-wrap");$("#hdFileCommentUpload").html5Uploader({postUrl:window.location.origin+"/comment/commentnew/CommentExt/UpImg",onClientError:function(){},onClientProgress:function(){},onClientLoadStart:function(){},onServerAbort:function(){},onServerError:function(){},onServerLoadStart:function(){console.log("uploadedFileCommentSubApp "+uploadedFileCommentSubApp);n.append("<div class='upload__img-box loading-amt'><svg viewBox = '0 0 36 36' class='circular-chart'> <path class='circle-bg' d='M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831'><\/path><path class='circle' stroke-dasharray='100, 100' d='M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831'><\/path><\/svg ><div class='img-bg'><div class='upload__img-close'><\/div><\/div><\/div> ");$("#commentUpload .upload__img-wrap").removeClass("hide")},onServerProgress:function(){},onClientLoad:function(){},onServerReadyStateChange:function(n,t,i){i==4&&n.currentTarget.status==404&&($("#commentUpload .upload__img-box.loading-amt").first().remove(),alert("Dung lượng ảnh tối đa 4 MB."))},onClientLoadEnd:function(){},onServerLoad:function(){},onSuccess:function(n){var t=$.parseJSON(n.currentTarget.response),i;t.status==-1?(alert("Xảy ra lỗi, vui lòng thử lại."),$(".loading-amt").length>0&&$("#commentUpload .upload__img-box.loading-amt").remove()):uploadedFileCommentSubApp<3?(i="<div class='upload__img-box'><div style='background-image: url("+t.imageUrl+")' data-number='"+$(".upload__img-close").length+"' data-file='"+t.imageName+"' class='img-bg'><div class='upload__img-close'><\/div><\/div><\/div>",$("#commentUpload .upload__img-box.loading-amt").first().replaceWith(i),uploadedFileCommentSubApp++):(console.log("Vui lòng upload tối đa 3 ảnh"),$("#commentUpload .upload__img-box.loading-amt").remove())}})}function initUploadV2APIComment(){$("#hdFileCommentUploadv2").each(function(){$(this).on("change",function(n){var t=$(".upload__img-box").length,i=n.target.files,r=Array.prototype.slice.call(i);r.forEach(function(n,i){var f,u,r;if(i+1+t>3){alert("Chỉ được upload tối đa 3 hình");return}if(!n.type.match("image.*")){isCallAjax=!1;return}if(n.size/1048576>5){isCallAjax=!1;alert("hình ảnh "+n.name+" không được quá 5mb");return}if(t>3)return $("#productimage").val(""),alert("Chỉ được upload tối đa 3 hình"),!1;if(f={file:n,path:"",isUpload:!1},u=!1,imgArraySubAppCmt.length>0)for(r=0;r<imgArraySubAppCmt.length;r++)imgArraySubAppCmt[r].file!==undefined&&imgArraySubAppCmt[r].file.name===n.name&&(u=!0);u||imgArraySubAppCmt.push(f);const e=isImageFile(n,!1,!1);e.then(t=>{if(t){var i=new FileReader;i.onload=function(){var r,t,u,f;$(".upload__img-wrap").removeClass("hide");r=document.createElement("div");r.classList.add("upload__img-close");r.setAttribute("onclick","deleteTempImageCmtSA(this)");r.setAttribute("data-file",n.name);t=document.createElement("div");t.appendChild(r);t.classList.add("img-bg");t.setAttribute("style",`background-image:url('${i.result}')`);u=document.createElement("div");u.classList.add("upload__img-box");f=document.createElement("div");t.appendChild(f);u.appendChild(t);$(".upload__img-wrap").append(u)};i.readAsDataURL(n)}else return alert("Không thể chọn file có định dạng khác PNG, JPEG! Tệp không hợp lệ: "+n.name),!1}).catch(n=>{console.error("Lỗi:",n)})})})})}function deleteTempImageCmtSA(n){var i,t,r;for(uploadedFile--,i=$(n).data("file"),console.log("filename remove: ",i),t=0;t<imgArraySubAppCmt.length;t++)imgArraySubAppCmt[t].file.name==i&&(imgArraySubAppCmt.splice(t,1),$(n).parent().parent().remove(),uploadedFile--);r=$(".wrap_cmt .upload__img-wrap .upload__img-box").length;r==0&&$(".wrap_cmt .upload__img-wrap").addClass("hide")}function getScriptUploadCmt(){isGetScriptUpload||$.getScript("https://cdn.tgdd.vn/mwgcart/avacomment/lib/html5uploader/jquery.html5uploader.min.js").done(function(){initUploadCommentSubApp();isGetScriptUpload=!0})}function customHostName(){const{isCallApi:n}=getParamsCmt();n&&(urlSub="https://webapi.thegioididong.com")}function initPersonelDataPolicyCmt(){$("#agree-policy-comment").unbind().click(function(){let n=$("#agree-policy-comment span");n.toggleClass("current");toggleSubmitBtnCmt();console.log("click policy")});$("#agree-policy-comment a").click(function(n){n.stopPropagation()});toggleSubmitBtnCmt()}function toggleSubmitBtnCmt(){console.log("toggleSubmitBtnCmt");let n=$("#agree-policy-comment span"),t=n.hasClass("current")||n.length==0;t?$(".btn-send.submit").removeClass("disabled"):$(".btn-send.submit").addClass("disabled")}function initCmtAjax(){$(".wrap_cmt").length>0&&$(".box-comment").length>0?initCmtControlAfterAjax():$(".wrap_cmt").length>0&&loadCmt()}function getParamsCmt(){let n=$(".wrap_cmt").attr("data-iscallapi"),t=$(".wrap_cmt").attr("data-ismb"),i=typeof n!="undefined"?n.toString().toLowerCase():"false",r=typeof t!="undefined"?t.toString().toLowerCase():"false";var u=encodeURIComponent($(".wrap_cmt").attr("data-urlimg")),f=$(".wrap_cmt").attr("data-objectid"),e=encodeURIComponent(window.location.href),o=$(".wrap_cmt").attr("data-title"),s=$(".wrap_cmt").attr("data-objecttype"),h=$(".wrap_cmt").attr("data-irt"),c=$(".wrap_cmt").attr("data-pagesize"),l=$(".wrap_cmt").attr("data-titletype"),a=JSON.parse(i),v=JSON.parse(r),y=$(".wrap_cmt").attr("data-isnews"),p=$(".wrap_cmt").attr("data-siteid");return{urlimg:u,objectId:f,url:e,title:o,objectType:s,isRating:h,siteId:p,pageSize:c,isCallApi:a,titleType:l,ismb:v,isnews:y}}function showUserLoginSub(n){if(n==-1&&$("#social .login").length>0){$("#social").show();$(".overlay-social").show();return}}function initNewsUser(n){var u,t,i,r;n==1&&($("#comment .wrap_cmt").length>0&&(window.onload=function(){$("#frmAddComment label").unbind()},$(window).width()<=768?(u=$(window).width()-15,$("#comment .wrap_cmt").attr("style","width: "+u+"px !important")):$("#comment .wrap_cmt").removeAttr("style")),t=$("#frmAddComment .group-cm").find("input[name='txtFullName']"),t.prop("disabled",!0),i=$("#frmAddComment .group-cm").find("input[name='txtPhone']"),i.prop("disabled",!0),r=$("#frmAddComment .group-cm").find("input[name='txtEmail']"),r.prop("disabled",!0),$("#frmAddComment label").unbind(),setTimeout(function(){var n=$("#usSocial"),u;n.length>0?(t.val(n.data("name")),i.val(n.data("phone")),r.val(n.data("email")),u=n.data("gender")?1:0,$(".gendercomment").find(`[data-gender=${u}]`).addClass("choose")):$("#frmAddComment").click(function(){return showUserLoginSub(-1),!1})},5e3))}function loadCmt(n="",t=""){const i=getParamsCmt();$.ajax({type:"POST",url:urlSub+"/comment/init",data:{customerPhone:n,customerName:t,isstaging:IsStaging,objectId:i.objectId,objectType:i.objectType,siteId:i.siteId,url:i.url,urlimg:i.urlimg,title:i.title,showRating:i.isRating,pageSize:i.pageSize,titleType:i.titleType,ismb:i.ismb},success:function(n){$(".wrap_cmt").html(n);(i.siteId==10||i.siteId==16)&&$(".wrap_cmt").addClass("wrap_border");$("div.box-comment").length&&initCmtControlAfterAjax()},error:function(n,t,i){console.log(n);console.log(t);console.log(i)},complete:function(){initImgGalleryCmt();initNewsUser(i.isnews)}})}function ResizeIframeCmt(){var n;if(window!==window.parent&&window.location.host===window.parent.location.host){var r=document.body,i=document.documentElement,u=$(".wrap_cmt").height()+resizedHeight,f=Math.max(r.scrollWidth,r.offsetWidth,i.clientWidth,i.scrollWidth,i.offsetWidth),t=window.parent.document.querySelectorAll('iframe[id="id-cmt"]');for(n=0;n<t.length;n++)if(t[n].contentWindow===window){t[n].height=u;t[n].width=f;break}if(typeof window.parent.window.onloadCallbackComment=="function")window.parent.window.onloadCallbackComment(u,f)}}function initCmtControlAfterAjax(){initEmlement();ResizeIframeCmt();initPersonelDataPolicyCmt();initUploadV2APIComment()}function initEmlement(){$("#commentUpload .send-img").unbind().click(function(){getScriptUploadCmt();var n=!1;n||($("#hdFileCommentUploadv2").click(),n=!0,console.log(""))});$("#frmAddComment .group-cm textarea[name=txtContent]").unbind().focus(function(){$("#frmAddComment .group-cm, #frmAddComment>button, .gendercomment").removeClass("hide");$(this).addClass("extend");$("#frmAddComment .upload__box").removeClass("hide");var n=getParamsCmt();(n.siteId==1||n.siteId==2||n.siteId==9)&&$(".staging").removeClass("staging");ResizeIframeCmt()});$("#frmAddComment label").not("#commentUpload label").unbind().click(function(){var n=$(this).data("gender");$(".gendercomment label").removeClass("choose");$(this).addClass("choose");$("input[name=hdGender]").val(n)});var n=$(".gendercomment label.choose").data("gender");$("input[name=hdGender]").val(n);$("#frmAddComment input[name=hdUrl]").val(window.location.href)}function initControl(){setTimeout(refreshCmtAnswer,3e4)}function selCmt(n){window.event.ctrlKey&&alert(n)}function refreshCmtAnswer(){$(".cmtalert").each(function(){var n=new Date($(this).data("time")),t=parseInt($(this).data("min")),i=new Date(n.getTime()+t*6e4);i<new Date&&$(this).remove()});setTimeout(refreshCmtAnswer,3e4)}function ReassignData(n,t,i){var r=n.find(n=>n.name===t);r.value=i}function getImgCommentSA(){if($("#commentUpload .img-bg").length>0){var n="";$("#commentUpload .img-bg").each(function(){var t=$(this).data("file");t!=null&&t!=""&&(n+=t+"╬")});$("#commentUpload .hdfRatingImg").val(n)}else $("#commentUpload .hdfRatingImg").val("")}function moveFileComment(n){var r=window.location.origin+"/comment/commentnew/CommentExt/MoveFileUpImg",i="",t;$("#commentUpload .img-bg").length>0&&($("#commentUpload .img-bg").each(function(){var n=$(this).data("file");n!=null&&n!=""&&(i+=n+"╬")}),t=new FormData,t.append("attachFile",i),t.append("commentID",n),$.ajax({url:r,type:"POST",processData:!1,contentType:!1,data:t,success:function(){},error:function(n,t,i){console.log(n.status);console.log(i)}}))}function AddComment(){var u,e,n,i;const r=event.submitter;if((r.disabled=!0,setTimeout(()=>{r.disabled=!1},2e3),flagAddComment)||!validateCommentAdd())return!1;u=getParamsCmt();flagAddComment=!0;$("#dlding").show();let f=$(".wrap_cmt").data("siteid");getImgCommentSA();e=$("#frmAddComment");n=e.serializeArray();n.push({name:"siteId",value:f});const t=LocationBySiteId(f);return t&&(n.push({name:"WardId",value:t.WardId}),n.push({name:"DistrictId",value:t.DistrictId}),n.push({name:"ProvinceId",value:t.ProvinceId})),u.isnews==1&&(i=$("#frmAddComment .group-cm"),n.push({name:"txtEmail",value:i.find("input[name='txtEmail']").val()}),n.push({name:"txtPhone",value:i.find("input[name='txtPhone']").val()}),n.push({name:"txtFullName",value:i.find("input[name='txtFullName']").val()})),n.push({name:"isStaging",value:IsStaging}),window!==window.parent?ReassignData(n,"hdUrl",encodeURIComponent(window.parent.location.href)):ReassignData(n,"hdUrl",encodeURIComponent(window.location.href)),$.ajax({type:"POST",cache:!1,data:n,url:urlSub+"/comment/CommentAdd/",success:function(n){if($("#dlding").fadeOut(),n.status==-1)return alert(n.message),$("#frmAddComment .group-cm [name=txtContent]").addClass("borderWn"),!1;var t=$(n).attr("id");$("#frmAddComment").after(n);$(".comment-pending").show();$("#frmAddComment").hide();$(".upload__img-wrap").html()!==""&&($("#"+t).find(".cmtpd-content").after($(".upload__img-wrap").prop("outerHTML")),$(".upload__img-close").remove());moveFileComment(t)},error:function(n,t,i){console.log(n);console.log(t);console.log(i)},complete:function(){flagAddComment=!1}}),!1}function validateOnlyNumber(n){var t=n.which,i=n.target.value;((t<48||t>57)&&t!==43||i.length>=10)&&n.preventDefault()}function ReplyComment(n){if(!flagReply){flagReply=!0;const t=getParamsCmt();return $.ajax({type:"POST",cache:!0,data:t,url:urlSub+"/comment/ReplyComment",success:function(t){if(flagReply=!1,t.status==-1)alert(t.message);else{$("#frmReplyComment").remove();var i=t;n.parent().parent().after(i);$("#frmReplyComment input[name=hdParentId]").val(n.data("parent"));$("#frmReplyComment textarea[name=txtContent]").val("@"+n.data("name")+": ").focus();$("#frmReplyComment > *").removeClass("hide");$("#frmReplyComment .upload__box").addClass("hide");reInitRepCmt()}},complete:function(){ResizeIframeCmt()}}),!1}}function SubmitReply(){if(!flagSubmitReply){flagSubmitReply=!0;$("#dlding").show();var n="&siteId="+$(".wrap_cmt").data("siteid"),t="&isStaging="+IsStaging,i=$("#frmReplyComment"),r=i.serialize()+n+t;return $.ajax({type:"POST",cache:!0,data:r,url:urlSub+"/comment/CommentAdd",success:function(n){var r,t,i;if($("#dlding").fadeOut(),flagSubmitReply=!1,n.status==-1)return alert(n.message),!1;$("#frmReplyComment").prev().hasClass("item")?$("#frmReplyComment").next().hasClass("commentlist-sub")?(r=$("#frmReplyComment").next(),r.append(n),$("#frmReplyComment").hide(),$(".comment-pending").show()):($("#frmReplyComment").prev().addClass("no-border"),t=$('<li class="commentlist-sub"><\/li>'),t.html(n),$("#frmReplyComment").replaceWith(t),$(".comment-pending").show()):(i=$(n),i.addClass("ischild_pending"),$("#frmReplyComment").replaceWith(i),$("#frmReplyComment").hide(),$(".comment-pending").show())}}),!1}}function LikeComment(n,t){flagLikeComment||(flagLikeComment=!0,$("#dlding").show(),$.ajax({type:"POST",cache:!0,data:{id:t},url:urlSub+"/comment/CommentLike",success:function(){var t,i;$("#dlding").fadeOut();flagLikeComment=!1;n.removeAttr("onclick");t=n.parent();t.find("span").removeClass("hide");t.find("i").addClass("iconcmt-likeR");i=parseInt(t.find(".cmtl b").text());t.find(".cmtl b").text(i+1)}}))}function validateName(n){return/^([^\\x00-\\x7F]|[_a-zA-Z0-9]|[\s])([_a-zA-Z0-9]|[\s]|[^\\x00-\\x7F])+$/.test(n)}function validateNameAddress(n){return/^([^\\x00-\\x7F]|[_a-zA-Z0-9]|[\s])([_a-zA-Z0-9]|[\s]|[^\\x00-\\x7F]|[,.:;%+"'!-=@|?*\\\/\)\(])+$/.test(n)}function validateEmail(n){return/^(([a-zA-Z]|[0-9])|([-]|[_]|[.]))+[@](([a-zA-Z0-9])|([-])){2,63}[.](([a-zA-Z0-9]){2,63})+$/.test(n)}function validateCommentAdd(){var n,i,t;return($("#frmAddComment .group-cm input").removeClass("borderWn"),$(".lbMsgCm").hide(),n=$("#frmAddComment .group-cm").find("textarea[name='txtContent']").val(),n===""||!validateNameAddress(n))?($("#frmAddComment .group-cm [name=txtContent]").addClass("borderWn"),!1):(i=$(".gendercomment .choose").length,i==0)?($(".lbMsgCm").show(),$(".lbMsgCm").html("Vui lòng chọn giới tính"),!1):(t=$("#frmAddComment .group-cm").find("input[name='txtFullName']").val(),t===""||!validateName(t))?($(".lbMsgCm").show(),$(".lbMsgCm").html("Họ và tên không hợp lệ"),$("#frmAddComment .group-cm [name=txtFullName]").addClass("borderWn"),!1):!0}function CommentList(n){const t=getParamsCmt();var i={objecttype:t.objectType,productid:t.objectId,page:n,siteId:t.siteId,pageSize:t.pageSize},r=urlSub+"/comment/PagingComment";$.ajax({url:r,type:"POST",data:i,cache:!1,beforeSend:function(){$("#dlding").show()},success:function(n){if(n!=null||n!="")try{$(".box-comment .comment-list").html(n)}catch(t){console.log(t);$("#dlding").hide()}},complete:function(){$("#dlding").hide();initImgGalleryCmt();ResizeIframeCmt()},error:function(){}});cmtScrollLst()}function checkHashTag(){if(window.location.hash){var n=window.location.hash.substring(1);(n.indexOf("cmthl")!=-1||n.indexOf("cmtkhl")!=-1)&&(console.log("#"+n),setTimeout(function(){var t=n.replace("cmthl",""),i,r;t=n.replace("cmtkhl","");i=$(".comment-list [name='hdObjectId']").val();r=$(".comment-list [name='hdObjectType']").val();$.ajax({type:"POST",cache:!0,data:{sKey:t,ObjectID:i,ObjectType:r},url:urlSub+"/comment/CommentSearch",success:function(n){$(".comment-list").hide();$(".comment-list").after(n);$(".comment-list").first().remove();$(".comment-list").show();reInitCmt()}})},1e3))}}function reInitCmt(){$("#frmAddComment textarea[name=txtContent]").focus(function(){$("#frmAddComment .group-cm>input, #frmAddComment>button, .gendercomment").removeClass("hide");$(this).addClass("extend");$("#frmAddComment .upload__box").removeClass("hide")});$("#frmCommentRating textarea[name=txtContent]").focus(function(){$("#frmCommentRating>input").removeClass("hide");$(this).addClass("extend")});$("#frmAddComment label").click(function(){var n=$(this).data("gender");$(".gendercomment label").removeClass("choose");$(this).addClass("choose");$("input[name=hdGender]").val(n)});$(".star>a").click(function(){var n=$(this).data("index"),t=1;$(".star>a").each(function(){t<=n?$(this).addClass("active"):$(this).removeClass("active");t++});$("input[name=hdScore]").val(n)});setTimeout(refreshCmtAnswer,3e4)}function reInitRepCmt(){$("#frmReplyComment textarea[name=txtContent]").focus(function(){$("#frmReplyComment .group-cm>input, #frmAddComment>button, #frmReplyComment .gendercomment").removeClass("hide");$(this).addClass("extend")});$("#frmReplyComment textarea[name=txtContent]").focus(function(){$("#frmCommentRating>input").removeClass("hide");$(this).addClass("extend")});$("#frmReplyComment label").unbind().click(function(){var n=$(this).data("gender");$(".gendercomment label").removeClass("choose");$(this).addClass("choose");$("input[name=hdGender]").val(n)});$("#frmReplyComment .agree").unbind().click(function(){let n=$("#frmReplyComment .agree span");n.toggleClass("current");console.log("click policy_rep")});$(".star>a").unbind().click(function(){var n=$(this).data("index"),t=1;$(".star>a").each(function(){t<=n?$(this).addClass("active"):$(this).removeClass("active");t++});$("input[name=hdScore]").val(n)});$("#frmReplyComment input[name=hdUrl]").val(window.parent.location.href);setTimeout(refreshCmtAnswer,3e4)}function GetAllFormData(n){var i=$(n).serializeArray(),t={};return $.map(i,function(n){t[n.name]=n.value}),t}function getCookieCmt(n){for(var r,u,i=document.cookie.split(";"),t=0;t<i.length;t++)if(r=i[t].substr(0,i[t].indexOf("=")),u=i[t].substr(i[t].indexOf("=")+1),r=r.replace(/^\s+|\s+$/g,""),r==n)return unescape(u)}function empty(n){var t;if(n===""||n===0||n==="0"||n===null||n===!1||n===undefined||$.trim(n)=="")return!0;if(typeof n=="object"){for(t in n)if(typeof n[t]!="function")return!1;return!0}return!1}function unsatisfiedCmt(n){if(window!==window.parent&&window.location.host===window.parent.location.host){var t=$(".wrapsatis").last().height();window.parent.document.getElementById("id-cmt").height=$("#wrs"+n).is(":visible")?$(".wrap_cmt").height()+50:$(".wrap_cmt").height()+50+t}$("#wrs"+n).slideToggle()}function closeSatis(){$(".wrapsatis").hide()}function sendSatisfied(n,t){var i="",r="",u="";if(t==2){var i=$.trim($("#wrs"+n+" .ustCt").val()),r=$.trim($("#wrs"+n+" .ustName").val()),u=$.trim($("#wrs"+n+" .ustPhone").val());if(i.length<10)return alert("Nội dung quá ít. Vui lòng nhập thêm."),!1;if(u.length>0&&r.length==0)return alert("Vui lòng nhập họ tên."),!1}else if(t==1)return $("#c-"+n+" .hl").css("font-weight","bold"),$("#c-"+n+" .hl").addClass("change-iconliked"),!1;$.ajax({type:"POST",data:{objUpdateCmt:{commentId:n,ipCreator:"",satisfactionType:t,description:i,fullName:r,phoneNumbe:u,siteId:getParamsCmt().siteId}},url:urlSub+"/comment/CommentSatis",success:function(t){if(t!=null){$(".mwrs").remove();closeSatis();$("#wrs"+n).after("<span class='mwrs'> Cám ơn bạn đã góp ý cho QTV<\/span>");$("#"+n+" .time").hide();$(".mwrs").fadeOut(7e3);setTimeout(function(){$(".mwrs").remove();$("#"+n+" .time").show()},8e3);$("#c-"+n+" .khl").css("font-weight","bold")}}})}function initImgGalleryCmt(){$(".commentImg-close.cmt").unbind().click(function(){$(".popup-commentImg.cmt").fadeOut();$(".bg-commentImg.cmt").fadeOut();$("body").removeClass("scrollHide");CloseMainPopupRatingIframe()});$(".bg-commentImg.cmt").unbind().click(function(){$(".popup-commentImg.cmt").fadeOut();$("body").removeClass("scrollHide");$(this).fadeOut();CloseMainPopupRatingIframe()});$(".gallery__tab a").unbind().click(function(n){n.preventDefault();$(".gallery__tab a").removeClass("act");var t=$(this).attr("href");t=t.substr(1);$(this).addClass("act");$(".gallery__content li").each(function(){$(this).hasClass(t)||t=="all"?$(this).removeClass("hide"):$(this).addClass("hide")})});$(".gallery-close.cmt").unbind().click(function(){closePopupGallerySACmt()});$(".bg-galleryImg.cmt").unbind().click(function(){closePopupGallerySACmt()})}function closePopupGallerySACmt(){$(".gallery.cmt").fadeOut(durationSA);$(".bg-galleryImg.cmt").fadeOut(durationSA);$("body").removeClass("scrollHide");CloseMainPopupRatingIframe()}function showPopupGallerySACmt(n){initRtSlideSubApp();initImgGalleryCmt();$(".gallery.cmt").fadeOut(durationSA);$(".bg-galleryImg.cmt").fadeOut(durationSA);$("body").addClass("scrollHide");$(".popup-commentImg.cmt").fadeIn(durationSA);$(".bg-commentImg.cmt").fadeIn(durationSA);var t=parseInt(n);$(".slider-commentImg.cmt").trigger("to.owl.carousel",t-1)}function PopupCmtImg(n){typeof $.fn.owlCarousel=="function"?showPopupGallerySACmt(n):$.getScript("https://cdn.tgdd.vn/mwgcart/avacomment/lib/OwlCarousel2/owl.carousel.min.js").done(function(){$("<link/>",{rel:"stylesheet",type:"text/css",href:"https://cdn.tgdd.vn/mwgcart/avacomment/lib/OwlCarousel2/assets/owl.carousel.min.css"}).appendTo("head");showPopupGallerySACmt(n)});StylePopupIframeCmt()}function StylePopupIframeCmt(){var t,n,i;if(isIframe)for(t=window.parent.document.querySelectorAll('iframe[id="id-cmt"]'),n=0;n<t.length;n++)if(t[n].contentWindow===window){i=t[n].parentElement;i&&(i.style.cssText="background-color: rgba(0, 0, 0); position: fixed; bottom: 0px; top: 0px; left: 0px; width: 100%; z-index: 22;");t[n].style.cssText="height: 100%;";break}}function CloseMainPopupRatingIframe(){var t,n,i;if(isIframe)for(t=window.parent.document.querySelectorAll('iframe[id="id-cmt"]'),n=0;n<t.length;n++)if(t[n].contentWindow===window){i=t[n].parentElement;i&&i.removeAttribute("style");t[n].style.cssText="";break}}function PopupGallleryImgCmt(){$(".popup-commentImg.cmt").fadeOut();$(".bg-commentImg.cmt").fadeOut();$("body").addClass("scrollHide");$(".gallery.cmt").fadeIn();$(".bg-galleryImg.cmt").fadeIn();StylePopupIframeCmt()}function getRatingGalleryContentById(n){let t=n.data("rid");typeof t=="undefined"||t<=0||n.hasClass("ajax-loaded")||$.ajax({url:"/comment/apicomment/getcommentbyid-min",type:"POST",data:{commentId:t},cache:!1,beforeSend:function(){},success:function(n){if(n.code==200&&n!=null&&n.data!=null){let r=n.data,i=$(`.item-content-${t}`);i.removeClass("hide-visibility");i.parents(".item").addClass("ajax-loaded");r.hasRecommendProduct==1&&i.find(".txt-intro").removeClass("hide");r.content!=""&&i.find(".item-ct").html(r.content);r.userProfile!=""&&i.find(".txt-name").html(r.userProfile);i.removeClass("hide-visibility")}},error:function(){}})}function getRatingOnSliderCmt(){initSliderRatingCmt||(initSliderRatingCmt=$(".slider-commentImg.cmt").on("changed.owl.carousel",function(n){if(n.item.index==0)getRatingGalleryContentById($($(".slider-commentImg.cmt .item")[0]));else{let t=$($(".slider-commentImg.cmt .owl-item .item")[n.item.index]);getRatingGalleryContentById(t)}}))}function initRtSlideSubApp(){let n=$(window).width();if(n>768)getRatingOnSliderCmt(),$(".slider-commentImg").owlCarousel({items:1,dots:!1,nav:!0,lazyLoad:!0,smartSpeed:100});else{getRatingOnSliderCmt();$(".slider-commentImg").on("initialized.owl.carousel changed.owl.carousel",function(n){n.namespace&&$(".counter-popup").text(n.relatedTarget.relative(n.item.index)+1+"/"+n.item.count)});$(".slider-commentImg").owlCarousel({items:1,dots:!1,nav:!1,lazyLoad:!0,smartSpeed:100})}}function goToRSlideByAttID(n){$(".rtAtt-"+n).click()}function cmtScrollLst(){$(".comment-list").length>0&&$([document.documentElement,document.body]).animate({scrollTop:$(".comment-list").last().offset().top},2e3)}function isImageFile(n,t,i){return new Promise((r,u)=>{const f=new FileReader;f.onload=function(n){const e=n=>String.fromCharCode.apply(null,n),o=n.target.result,f=new Uint8Array(o),s=f.subarray(0,4).toString(),u=e(f.subarray(0,8));u.startsWith("PNG\r\n\x1a\n")?r(!0):u.includes("GIF87a")?r(!0):["ÿØÿ","JFIF","Exif","PJPEG"].some(n=>u.includes(n))?r(!0):u.startsWith("%PDF")&&t==!0?r(!0):["ÐÏà","PK\x03\x04"].some(n=>u.includes(n))&&i==!0?r(!0):(console.log(!1),r(!1))};f.onerror=function(n){u(n)};f.readAsArrayBuffer(n)})}function AllCommentByUserId(n){console.log("getAllCommentByUserId");var t=n;$.ajax({url:"/comment/GetListCommentByUser",type:"GET",processData:!1,contentType:!1,data:t,beforeSend:function(){},success:function(n){$(".wrap_cmtall").html(n)},error:function(){}})}var LocationBySiteId,flagAddComment,flagReply,flagSubmitReply,flagLikeComment,initSliderRatingCmt;(function(n){n.fn.html5Uploader=function(t){function e(n){var e=new FileReader,t,s,o;e.onabort=function(t){if(i.onClientAbort)i.onClientAbort(t,n)};e.onerror=function(t){if(i.onClientError)i.onClientError(t,n)};e.onload=function(t){if(i.onClientLoad)i.onClientLoad(t,n)};e.onloadend=function(t){if(i.onClientLoadEnd)i.onClientLoadEnd(t,n)};e.onloadstart=function(t){if(i.onClientLoadStart)i.onClientLoadStart(t,n)};e.onprogress=function(t){if(i.onClientProgress)i.onClientProgress(t,n)};e.readAsDataURL(n);t=new XMLHttpRequest;t.upload.onabort=function(t){if(i.onServerAbort)i.onServerAbort(t,n)};t.upload.onerror=function(t){if(i.onServerError)i.onServerError(t,n)};t.upload.onload=function(t){if(i.onServerLoad)i.onServerLoad(t,n)};t.upload.onloadstart=function(t){if(i.onServerLoadStart)i.onServerLoadStart(t,n)};t.upload.onprogress=function(t){if(i.onServerProgress)i.onServerProgress(t,n)};t.onreadystatechange=function(r){if(i.onServerReadyStateChange)i.onServerReadyStateChange(r,n,t.readyState);if(i.onSuccess&&t.readyState==4&&t.status==200)i.onSuccess(r,n,t.responseText);if(i.onServerError&&t.readyState==2&&t.status==500)i.onServerError(r,n)};t.open("POST",i.postUrl,!0);n.getAsBinary?(s=f+u+r+'Content-Disposition: form-data;name="'+i.name+'";filename="'+unescape(encodeURIComponent(n.name))+'"'+r+"Content-Type: application/octet-stream"+r+r+n.getAsBinary()+r+f+u+f,t.setRequestHeader("Content-Type","multipart/form-data;boundary="+u),t.sendAsBinary(s)):window.FormData&&(o=new FormData,o.append(i.name,n),t.send(o))}var r="\r\n",u="iloveigloo",f="--",i={maxFile:3,maxSize:10,name:"uploadedFile",postUrl:"Upload.ashx",onClientAbort:null,onClientError:null,onClientLoad:null,onClientLoadEnd:null,onClientLoadStart:null,onClientProgress:null,onServerAbort:null,onServerError:null,onServerLoad:null,onServerLoadStart:null,onServerProgress:null,onServerReadyStateChange:null,onSuccess:null};return t&&n.extend(i,t),this.each(function(){var t=n(this);t.is('[type="file"]')?t.bind("change",function(){var n=this.files,t;if(typeof uploadedFile!="undefined"?uploaded=uploadedFile+n.length:typeof uploadedFileMap!="undefined"&&rating_popup.data("index")>-1&&(uploaded=uploadedFileMap.get(`uploadedFile${rating_popup.data("index")}`)+n.length),typeof uploaded!="undefined"&&uploaded>i.maxFile)return alert("Chỉ cho phép tối đa "+i.maxFile+" file. Quý khách vui lòng gửi lại."),!1;for(t=0;t<n.length;t++){if(n[t].size>i.maxSize*1048576)return alert("Dung lượng tối đa cho phép là "+i.maxSize+"MB."),!1;e(n[t])}}):t.bind("dragenter dragover",function(){return!1}).bind("drop",function(n){var t=n.originalEvent.dataTransfer.files,r;if(typeof uploadedFile!="undefined"?uploaded=uploadedFile+t.length:typeof uploadedFileMap!="undefined"&&rating_popup.data("index")>-1&&(uploaded=uploadedFileMap.get(`uploadedFile${rating_popup.data("index")}`)+t.length),typeof uploaded!="undefined"&&uploaded>i.maxFile)return alert("Chỉ cho phép tối đa "+i.maxFile+" file. Quý khách vui lòng gửi lại."),!1;for(r=0;r<t.length;r++){if(t[r].size>i.maxSize*1048576)return alert("Dung lượng tối đa cho phép là "+i.maxSize+"MB."),!1;e(t[r])}return!1})})}})(jQuery);var urlSub=window.location.origin,uploadedFileCommentSubApp=0,IsStaging=urlSub.indexOf("newstg")!=-1||urlSub.indexOf("newstaging")!=-1||urlSub.indexOf("staging")!=-1||urlSub.indexOf("localhost")!=-1,isGetScriptUpload=!1;const isSocialPage=window.location.pathname.indexOf("kinh-nghiem-hay")!=-1||window.location.pathname.indexOf("tin-tuc")!=-1||window.location.pathname.indexOf("game-app")!=-1||window.location.pathname.indexOf("vao-bep")!=-1||window.location.pathname.indexOf("hoi-dap")!=-1;var isIframe=window!==window.parent&&window.location.host===window.parent.location.host,isMobile=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent),resizedHeight=isMobile?50:100,durationSA=isIframe?0:400,siteIdOffCmt=[1,2,10,16,17],imgArraySubAppCmtCmt=[];$(document).ready(function(){var n=getParamsCmt(),t=siteIdOffCmt.includes(parseInt(n.siteId));t&&!isSocialPage?$(".wrap_cmt").remove():(customHostName(),initCmtAjax())});LocationBySiteId=n=>{if(n==1||n==2){let t=IsStaging?"DMX_Personal_Staging":"DMX_Personal",n=getCookieCmt(t);if(n){let t=JSON.parse(n);const i=t.WardId,r=t.DistrictId,u=t.ProvinceId;return console.log(t),{WardId:i,DistrictId:r,ProvinceId:u}}}if(n==9||n==11){const n=Number(getCookieCmt("location_wardID")),t=Number(getCookieCmt("location_districtID")),i=Number(getCookieCmt("location_provID"));return{WardId:n,DistrictId:t,ProvinceId:i}}};flagAddComment=!1;flagReply=!1;flagSubmitReply=!1;flagLikeComment=!1;